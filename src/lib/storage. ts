// src/lib/storage.ts
// src/lib/storage.ts

export type AssessmentResponses = {
  [pillarId: number]: { rating: number; answers: Record<string, string> };
};

export type ClientRecord = {
  id: string;
  name?: string;
  dateISO: string;
  responses: AssessmentResponses;
  priorities: number[];
};

// internal helpers
function readAll(): Record<string, ClientRecord> {
  try {
    const raw = localStorage.getItem('clients');
    return raw ? (JSON.parse(raw) as Record<string, ClientRecord>) : {};
  } catch {
    return {};
  }
}
function writeAll(all: Record<string, ClientRecord>) {
  localStorage.setItem('clients', JSON.stringify(all));
}

// API
function getAllClients(): Record<string, ClientRecord> {
  return readAll();
}
function getClient(id: string): ClientRecord | undefined {
  return readAll()[id];
}
function saveClient(record: ClientRecord) {
  const all = readAll();
  all[record.id] = record;
  writeAll(all);
}
function clearAll() {
  localStorage.removeItem('clients');
}
function deleteClient(id: string) {
  const all = readAll();
  delete all[id];
  writeAll(all);
}

// âœ… default export to avoid named-export issues
const storage = { getAllClients, getClient, saveClient, clearAll, deleteClient };
export default storage;
